CREATE OR REPLACE PACKAGE XX3A_DATA_VALIDATION IS
	PROCEDURE XX3A_DATA_LOAD(ERRBUF OUT VARCHAR2,RETCODE OUT NUMBER);
	FUNCTION VALIDATE_JN(V_USER_JE_SOURCE_NAME VARCHAR2) RETURN BOOLEAN;
	FUNCTION VALIDATE_JF(V_OVERRIDE_EDITS_FLAG VARCHAR2) RETURN BOOLEAN;
	FUNCTION VALIDATE_ED(V_EFFECTIVE_DATE_RULE_CODE VARCHAR2) RETURN BOOLEAN;
END XX3A_DATA_VALIDATION;



CREATE OR REPLACE PACKAGE BODY XX3A_DATA_VALIDATION IS

PROCEDURE XX3A_DATA_LOAD(ERRBUF OUT VARCHAR2,RETCODE OUT NUMBER) IS
 CURSOR C IS SELECT USER_JE_SOURCE_NAME,JE_SOURCE_KEY,
 DESCRIPTION,JOURNAL_REFERENCE_FLAG,
 JOURNAL_APPROVAL_FLAG,IMPORT_USING_KEY_FLAG,
 OVERRIDE_EDITS_FLAG,EFFECTIVE_DATE_RULE_CODE FROM APPSREAD.XX3_JOURNAL_TBL;


V_USER_JE_SOURCE_NAME  APPSREAD.XX3_JOURNAL_TBL.USER_JE_SOURCE_NAME%TYPE;
V_JE_SOURCE_KEY  APPSREAD.XX3_JOURNAL_TBL.JE_SOURCE_KEY%TYPE;
V_DESCRIPTION  APPSREAD.XX3_JOURNAL_TBL.DESCRIPTION%TYPE;
V_JOURNAL_REFERENCE_FLAG  APPSREAD.XX3_JOURNAL_TBL.JOURNAL_REFERENCE_FLAG%TYPE;
V_JOURNAL_APPROVAL_FLAG  APPSREAD.XX3_JOURNAL_TBL.JOURNAL_APPROVAL_FLAG%TYPE;
V_IMPORT_USING_KEY_FLAG  APPSREAD.XX3_JOURNAL_TBL.IMPORT_USING_KEY_FLAG%TYPE;
V_OVERRIDE_EDITS_FLAG  APPSREAD.XX3_JOURNAL_TBL.OVERRIDE_EDITS_FLAG%TYPE;
V_EFFECTIVE_DATE_RULE_CODE  APPSREAD.XX3_JOURNAL_TBL.EFFECTIVE_DATE_RULE_CODE%TYPE;

BEGIN 
OPEN C;
LOOP
FETCH C INTO V_USER_JE_SOURCE_NAME,V_JE_SOURCE_KEY,
             V_DESCRIPTION,V_JOURNAL_REFERENCE_FLAG,
             V_JOURNAL_APPROVAL_FLAG,V_IMPORT_USING_KEY_FLAG,
	     V_OVERRIDE_EDITS_FLAG,V_EFFECTIVE_DATE_RULE_CODE;
EXIT WHEN C%NOTFOUND;

IF(VALIDATE_JN(V_USER_JE_SOURCE_NAME)) THEN
  IF(V_JE_SOURCE_KEY IS NULL) THEN
       V_JE_SOURCE_KEY:=V_USER_JE_SOURCE_NAME;
  END IF;	
           IF(VALIDATE_JF(V_OVERRIDE_EDITS_FLAG)) THEN
		IF(VALIDATE_ED(V_EFFECTIVE_DATE_RULE_CODE)) THEN
			INSERT INTO APPSREAD.XX3_JOURNAL_ORG(USER_JE_SOURCE_NAME,JE_SOURCE_KEY,
						    DESCRIPTION,JOURNAL_REFERENCE_FLAG,
						    JOURNAL_APPROVAL_FLAG,IMPORT_USING_KEY_FLAG,
        					    OVERRIDE_EDITS_FLAG,EFFECTIVE_DATE_RULE_CODE)
	                VALUES(V_USER_JE_SOURCE_NAME,V_JE_SOURCE_KEY,
                               V_DESCRIPTION,V_JOURNAL_REFERENCE_FLAG,
                               V_JOURNAL_APPROVAL_FLAG,V_IMPORT_USING_KEY_FLAG,
	                       V_OVERRIDE_EDITS_FLAG,V_EFFECTIVE_DATE_RULE_CODE);
			FND_FILE.PUT_LINE(FND_FILE.OUTPUT,'INSERTED RECORD:' || CHR(9) ||
					V_USER_JE_SOURCE_NAME || ' ; ' ||
					V_JE_SOURCE_KEY || ' ; ' ||
					V_DESCRIPTION  	|| ' ; ' ||
					V_JOURNAL_REFERENCE_FLAG || ' ; ' ||
					V_JOURNAL_APPROVAL_FLAG  || ' ; ' ||
					V_IMPORT_USING_KEY_FLAG  || ' ; ' ||
					V_OVERRIDE_EDITS_FLAG    || ' ; ' ||
					V_EFFECTIVE_DATE_RULE_CODE); 
                ELSE
			INSERT INTO APPSREAD.XX3_JOURNAL_ERR(USER_JE_SOURCE_NAME,JE_SOURCE_KEY,
						    DESCRIPTION,JOURNAL_REFERENCE_FLAG,
						    JOURNAL_APPROVAL_FLAG,IMPORT_USING_KEY_FLAG,
        					    OVERRIDE_EDITS_FLAG,EFFECTIVE_DATE_RULE_CODE)
	                VALUES(V_USER_JE_SOURCE_NAME,V_JE_SOURCE_KEY,
                               V_DESCRIPTION,V_JOURNAL_REFERENCE_FLAG,
                               V_JOURNAL_APPROVAL_FLAG,V_IMPORT_USING_KEY_FLAG,
	                       V_OVERRIDE_EDITS_FLAG,V_EFFECTIVE_DATE_RULE_CODE);
			FND_FILE.PUT_LINE(FND_FILE.LOG,'REJECTED RECORD:' || CHR(9) ||
					V_USER_JE_SOURCE_NAME || ' ; ' ||
					V_JE_SOURCE_KEY || ' ; ' ||
					V_DESCRIPTION  	|| ' ; ' ||
					V_JOURNAL_REFERENCE_FLAG || ' ; ' ||
					V_JOURNAL_APPROVAL_FLAG  || ' ; ' ||
					V_IMPORT_USING_KEY_FLAG  || ' ; ' ||
					V_OVERRIDE_EDITS_FLAG    || ' ; ' ||
					V_EFFECTIVE_DATE_RULE_CODE); 
                END IF;
		ELSE
                        INSERT INTO APPSREAD.XX3_JOURNAL_ERR(USER_JE_SOURCE_NAME,JE_SOURCE_KEY,
						    DESCRIPTION,JOURNAL_REFERENCE_FLAG,
						    JOURNAL_APPROVAL_FLAG,IMPORT_USING_KEY_FLAG,
        					    OVERRIDE_EDITS_FLAG,EFFECTIVE_DATE_RULE_CODE)
	                VALUES(V_USER_JE_SOURCE_NAME,V_JE_SOURCE_KEY,
                               V_DESCRIPTION,V_JOURNAL_REFERENCE_FLAG,
                               V_JOURNAL_APPROVAL_FLAG,V_IMPORT_USING_KEY_FLAG,
	                       V_OVERRIDE_EDITS_FLAG,V_EFFECTIVE_DATE_RULE_CODE);
			FND_FILE.PUT_LINE(FND_FILE.LOG,'REJECTED RECORD:' || CHR(9) ||
					V_USER_JE_SOURCE_NAME || ' ; ' ||
					V_JE_SOURCE_KEY || ' ; ' ||
					V_DESCRIPTION  	|| ' ; ' ||
					V_JOURNAL_REFERENCE_FLAG || ' ; ' ||
					V_JOURNAL_APPROVAL_FLAG  || ' ; ' ||
					V_IMPORT_USING_KEY_FLAG  || ' ; ' ||
					V_OVERRIDE_EDITS_FLAG    || ' ; ' ||
					V_EFFECTIVE_DATE_RULE_CODE);
            END IF;
            
 ELSE
			INSERT INTO APPSREAD.XX3_JOURNAL_ERR(USER_JE_SOURCE_NAME,JE_SOURCE_KEY,
						    DESCRIPTION,JOURNAL_REFERENCE_FLAG,
						    JOURNAL_APPROVAL_FLAG,IMPORT_USING_KEY_FLAG,
        					    OVERRIDE_EDITS_FLAG,EFFECTIVE_DATE_RULE_CODE)
	                VALUES(V_USER_JE_SOURCE_NAME,V_JE_SOURCE_KEY,
                               V_DESCRIPTION,V_JOURNAL_REFERENCE_FLAG,
                               V_JOURNAL_APPROVAL_FLAG,V_IMPORT_USING_KEY_FLAG,
	                       V_OVERRIDE_EDITS_FLAG,V_EFFECTIVE_DATE_RULE_CODE);
			FND_FILE.PUT_LINE(FND_FILE.LOG,'REJECTED RECORD:' || CHR(9) ||
					V_USER_JE_SOURCE_NAME || ' ; ' ||
					V_JE_SOURCE_KEY || ' ; ' ||
					V_DESCRIPTION  	|| ' ; ' ||
					V_JOURNAL_REFERENCE_FLAG || ' ; ' ||
					V_JOURNAL_APPROVAL_FLAG  || ' ; ' ||
					V_IMPORT_USING_KEY_FLAG  || ' ; ' ||
					V_OVERRIDE_EDITS_FLAG    || ' ; ' ||
					V_EFFECTIVE_DATE_RULE_CODE);
 END IF;
END LOOP;
CLOSE C;
END XX3A_DATA_LOAD;


FUNCTION VALIDATE_JN(V_USER_JE_SOURCE_NAME VARCHAR2) RETURN BOOLEAN IS
V_COUNT NUMBER;

BEGIN
	SELECT COUNT(USER_JE_SOURCE_NAME)
	INTO V_COUNT
	FROM APPSREAD.XX3_JOURNAL_TBL
	WHERE USER_JE_SOURCE_NAME=V_USER_JE_SOURCE_NAME;
	IF(V_COUNT<=1) THEN
		RETURN TRUE;
	ELSE
		RETURN FALSE;
	END IF;
END VALIDATE_JN;

FUNCTION VALIDATE_JF(V_OVERRIDE_EDITS_FLAG VARCHAR2) RETURN BOOLEAN IS

BEGIN
	IF(V_OVERRIDE_EDITS_FLAG IS NULL) THEN
		RETURN FALSE;
	ELSE
		RETURN TRUE;
	END IF;

END VALIDATE_JF;

FUNCTION VALIDATE_ED(V_EFFECTIVE_DATE_RULE_CODE VARCHAR2) RETURN BOOLEAN IS

BEGIN
	IF(V_EFFECTIVE_DATE_RULE_CODE IS NULL) THEN
		RETURN FALSE;
	ELSE
		RETURN TRUE;
	END IF;

END VALIDATE_ED;
END XX3A_DATA_VALIDATION;




